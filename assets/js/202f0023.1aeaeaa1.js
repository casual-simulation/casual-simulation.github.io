"use strict";(self.webpackChunkcasual_simulation=self.webpackChunkcasual_simulation||[]).push([[2680],{6907:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>h,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var r=n(6106),t=n(7877),i=n(7644);const o={id:"security",title:"Security",sidebar_label:"Security",description:"Learn how to secure records using permissions and roles"},a=void 0,c={id:"learn/records/security",title:"Security",description:"Learn how to secure records using permissions and roles",source:"@site/docs/learn/records/security.mdx",sourceDirName:"learn/records",slug:"/learn/records/security",permalink:"/learn/records/security",draft:!1,unlisted:!1,editUrl:"https://github.com/casual-simulation/casualos/tree/develop/docs/docs/learn/records/security.mdx",tags:[],version:"current",frontMatter:{id:"security",title:"Security",sidebar_label:"Security",description:"Learn how to secure records using permissions and roles"},sidebar:"docs",previous:{title:"Scripting",permalink:"/learn/scripting"},next:{title:"Tag Types",permalink:"/tags"}},h={},l=[{value:"Overview",id:"overview",level:2},{value:"Resource Markers",id:"resource-markers",level:3},{value:"Permissions",id:"permissions",level:3},{value:"Roles",id:"roles",level:3},{value:"Subjects",id:"subjects",level:3},{value:"Default Permissions &amp; Roles",id:"default-permissions--roles",level:3},{value:"Key Points",id:"key-points",level:2}];function d(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(s.p,{children:'CasualOS supports various kinds of permanent storage. Key/Value storage is supported by data records, and blob storage is supported by file records. There are also event records, and more kinds of functionality will be coming in the future. Collectively, it is useful for think about all these kinds as "resources". Resources are stored in records, and access to resources is governed by three things:'}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Resource Markers"}),"\n",(0,r.jsx)(s.li,{children:"Permissions"}),"\n",(0,r.jsx)(s.li,{children:"Roles"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Let's start with the first:"}),"\n",(0,r.jsx)(s.h3,{id:"resource-markers",children:"Resource Markers"}),"\n",(0,r.jsx)(s.p,{children:"Resource Markers (also known as Record Markers) are indicators that are used to indentify which policies govern the usage of which resources.\nFor now, markers are stored alongside the resource and are simply the a that is used to govern access to the resource."}),"\n",(0,r.jsx)(s.p,{children:"If a resource marker is assigned to a resource, then the permissions for that marker name controls how access to that resource is managed.\nA resource can be assigned multiple resource markers, and when such a case arises, then any permission from either of the markers can be used to grant access to the resource."}),"\n",(0,r.jsx)(s.h3,{id:"permissions",children:"Permissions"}),"\n",(0,r.jsx)(s.p,{children:"Permissions are rules that grant access to resources. By default, CasualOS denies all access to resources, so permissions need to be used to grant any sort of ability to read, update, create, or delete resources.\nAll permissions grant access to a subject, which is either an identity (user or inst), or a role. See the section below on subjects for more information. Permissions can also limit the scope of their grant by specifying a specific resource kind, or action that may be performed."}),"\n",(0,r.jsx)(s.p,{children:"As mentioned above, permissions control access to resources. For any request, the system searches for a permission that matches the current identity(s) and resource. If a permission is found, then the request is allowed. If none is found, then the request is denied.\nSome requests have multiple identities. For example, a request may be coming from inside an inst. In such a case, the system checks if both the user and the inst have the necessary permissions to access the resource. If either of them do not, then the request is denied."}),"\n",(0,r.jsx)(s.p,{children:"There are two kinds of permissions:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Marker Permissions"}),"\n",(0,r.jsx)(s.li,{children:"Resource Permissions"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Marker permissions are used to grant access to resources that have a specific resource marker applied to them. For example, if a data record has the ",(0,r.jsx)(s.code,{children:"secret"})," resource marker applied to it, then the marker permissions for ",(0,r.jsx)(s.code,{children:"secret"})," control how access is granted."]}),"\n",(0,r.jsx)(s.p,{children:"They have the following structure:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"let markerPermission: {\n    /**\n     * The name of the resource marker that this permission grants access to.\n     */\n    marker: string,\n    \n    /**\n     * The kind of the resource.\n     * If null, then the permission grants access to every resource that has the marker.\n     */\n    resourceKind: 'data' | 'file' | 'event' | 'inst' | null,\n\n    /**\n     * The action that the permission grants access to.\n     * If null, then the permission grants access to every action.\n     */\n    action: 'create' | 'read' | 'update' | 'delete' | 'list' | 'increment' | 'count' | null;\n\n    /**\n     * The type of the subject that the permission grants access to.\n     * If 'role', then the permission grants access to any identity that has the role.\n     * If 'user', then the permission grants access to a specific user.\n     * If 'inst', then the permission grants access to a specific inst.\n     */\n    subjectType: 'role' | 'user' | 'inst';\n\n    /**\n     * The ID of the subject.\n     * If the subjectType is 'role', then this is the name of the role.\n     * If the subjectType is 'user', then this is the ID of the user.\n     * If the subjectType is 'inst', then this is the ID of the inst.\n     */\n    subjectId: string;\n\n    /**\n     * The expiration time of the permission in unix time in milliseconds.\n     * If null, then the permission does not expire.\n     */\n    expireTimeMs: number | null;\n\n    /**\n     * Additional options for the permission.\n     * This is always an empty object for now.\n     */\n    options: {}\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"Resource permissions are used to grant access to specific resources."}),"\n",(0,r.jsx)(s.p,{children:"They have the following structure:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"let resourcePermission: {\n    /**\n     * The kind of the resource.\n     */\n    resourceKind: 'data' | 'file' | 'event' | 'inst',\n\n    /**\n     * The ID of the resource.\n     * For data records, this is the address of the record.\n     * For file records, this is the name of the file.\n     * For event records, this is the name of the event.\n     * For insts, this is the ID of the inst.\n     */\n    resourceId: string;\n\n    /**\n     * The action that the permission grants access to.\n     * If null, then the permission grants access to every action.\n     */\n    action: 'create' | 'read' | 'update' | 'delete' | 'list' | 'increment' | 'count' | null;\n\n    /**\n     * The type of the subject that the permission grants access to.\n     * If 'role', then the permission grants access to any identity that has the role.\n     * If 'user', then the permission grants access to a specific user.\n     * If 'inst', then the permission grants access to a specific inst.\n     */\n    subjectType: 'role' | 'user' | 'inst';\n\n    /**\n     * The ID of the subject.\n     * If the subjectType is 'role', then this is the name of the role.\n     * If the subjectType is 'user', then this is the ID of the user.\n     * If the subjectType is 'inst', then this is the ID of the inst.\n     */\n    subjectId: string;\n\n    /**\n     * The expiration time of the permission in unix time in milliseconds.\n     * If null, then the permission does not expire.\n     */\n    expireTimeMs: number | null;\n\n    /**\n     * Additional options for the permission.\n     * This is always an empty object for now.\n     */\n    options: {}\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Permissions can be created by calling ",(0,r.jsx)(i.t5,{action:"os.grantPermission()"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"roles",children:"Roles"}),"\n",(0,r.jsx)(s.p,{children:"Roles are like resource markers, but they are applied to identites. Identities in this case are users and instances, but more will come in the future."}),"\n",(0,r.jsx)(s.p,{children:"Generally, any system that is able to act on its own is an identity. Users are able to act on their own, so they are identities. Insts are also able to act (via code), so they also get their own identites."}),"\n",(0,r.jsx)(s.p,{children:"Like resource markers, users and insts can be assigned multiple roles and they are then used to associate users & insts with specific permissions from a policy."}),"\n",(0,r.jsx)(s.p,{children:"Unlike resource markers, roles can have additional rules that determine when a user can impersonate them. For example, a role can be set to expire after a set time so that a user only has limited access to a resource."}),"\n",(0,r.jsxs)(s.p,{children:["Many permissions require that both the user and the inst be authorized to access the resource. As a result, if the user needs to use a role to access the resource, but the inst does not, then the request is rejected. This is to help prevent the ",(0,r.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Confused_deputy_problem",children:"Confused Deputy Problem"}),", where the user is logged in but the inst tries to access something that is shouldn't have access to."]}),"\n",(0,r.jsxs)(s.p,{children:["Users can be granted roles by calling ",(0,r.jsx)(i.t5,{action:"os.grantUserRole()"}),". Insts can be granted roles by calling ",(0,r.jsx)(i.t5,{action:"os.grantInstRole()"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"subjects",children:"Subjects"}),"\n",(0,r.jsx)(s.p,{children:"Subjects are the entities that permissions can grant access to. There are three kinds of subjects:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Roles"}),"\n",(0,r.jsx)(s.li,{children:"Users"}),"\n",(0,r.jsx)(s.li,{children:"Insts"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Roles are a way of grouping multiple identities together and granting the same permissions to them. For example, if user1 and user2 both have the ",(0,r.jsx)(s.code,{children:"developer"})," role, then they both have all the permissions that are granted to the ",(0,r.jsx)(s.code,{children:"developer"})," role."]}),"\n",(0,r.jsxs)(s.p,{children:["Users are the people who use the system. They are the ones who log in and interact with the system. Permissions can grant access to a specific user by using their ID. You can find the ID of the current user by getting the ID of the ",(0,r.jsx)(s.code,{children:"authBot"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"Insts are user scripts that run inside CasualOS. They can perform actions on behalf of the user, and can be granted permissions to access resources.\nAs such, insts cannot grant permissions by themselves, but must always be accompanied by a user.\nThis means that resources can only be accessed by an inst if the user also has been granted permissions."}),"\n",(0,r.jsxs)(s.p,{children:["Permissions can grant access to a specific inst by using their ID.\nInst IDs are formatted like this: ",(0,r.jsx)(s.code,{children:"{recordName}/{inst}"}),", where ",(0,r.jsx)(s.code,{children:"{recordName}"})," is the name of the record that the inst resides in, and ",(0,r.jsx)(s.code,{children:"{inst}"})," is the name of the inst.\nFor public/free insts and static/local insts, the ",(0,r.jsx)(s.code,{children:"{recordName}"})," portion is omitted and the ID is just ",(0,r.jsx)(s.code,{children:"{inst}"})," or ",(0,r.jsx)(s.code,{children:"/{inst}"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"default-permissions--roles",children:"Default Permissions & Roles"}),"\n",(0,r.jsx)(s.p,{children:"By default, CasualOS grants some permissions by default to make usage easier and prevent users from getting locked out."}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Record owners and studio admins full access to all resources in the record."}),"\n",(0,r.jsxs)(s.li,{children:["Any user or inst that is granted the ",(0,r.jsx)(s.code,{children:"admin"})," role has full access to all resources in the record."]}),"\n",(0,r.jsx)(s.li,{children:"Studio members have read/write access to all resources in the record, but they cannot change permissions or roles."}),"\n",(0,r.jsx)(s.li,{children:"Private Insts are granted full access to the records that they live inside. This is to allow insts to read and write data without needing to be granted permissions."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"CasualOS also provides some default markers:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"publicRead"})," - This marker can be used to grant read access to any user or inst. It is useful for making resources able to be accessed by anyone, but only updated by authorized users."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"publicWrite"})," - This marker can be used to grant read/write access to any user or inst. It is useful for making resources able to be accessed and updated by anyone."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"private"})," - This marker is used for all list actions that do not list resources by a marker. Only admin users have access to these resources by default."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"account"})," - This marker is used for all role and permission resources. Only admin users have access to these resources by default."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"key-points",children:"Key Points"}),"\n",(0,r.jsx)(s.p,{children:"Permissions and Roles control who is allowed to access specific resources, and are a powerful tool for managing permissions and access."}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Marker permissions map resource markers to subjects."}),"\n",(0,r.jsx)(s.li,{children:"Resource permissions map resources to subjects."}),"\n",(0,r.jsx)(s.li,{children:"Roles are a way of grouping multiple identities together."}),"\n",(0,r.jsx)(s.li,{children:"Resource markers are applied to resources and determine which permissions apply to the resource."}),"\n",(0,r.jsx)(s.li,{children:"Roles are assigned to identities and determine which specific permissions an identity can use."}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);